/** @type {import('sequelize-cli').Migration} */
export default {
  async up(queryInterface, Sequelize) {
    const now = new Date();

    const camposBase = [
      {
        nombre: 'peso_neto',
        etiqueta: 'Peso Neto',
        descripcion: 'Peso neto del producto en kilogramos',
        tipo: 'decimal',
        aplica_a: 'productos',
        grupo: 'Características',
        industria: 'general',
        orden: 1,
        placeholder: 'Ej: 1.25',
        ayuda: 'Ingrese el peso neto en kilogramos',
        icono: 'weight',
        valor_default: null,
        opciones: null,
        validaciones: { min: 0 },
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'unidad_medida',
        etiqueta: 'Unidad de Medida',
        descripcion: 'Unidad principal para el producto',
        tipo: 'select',
        aplica_a: 'productos',
        grupo: 'Características',
        industria: 'general',
        orden: 2,
        placeholder: 'Selecciona unidad',
        ayuda: 'Selecciona la unidad habitual del producto',
        icono: 'ruler',
        valor_default: 'unidad',
        opciones: [
          { value: 'unidad', label: 'Unidad' },
          { value: 'kg', label: 'Kilogramo' },
          { value: 'lt', label: 'Litro' },
          { value: 'm', label: 'Metro' },
        ],
        validaciones: {},
        obligatorio: true,
        visible_en_listado: true,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'fecha_lanzamiento',
        etiqueta: 'Fecha de Lanzamiento',
        descripcion: 'Fecha en la que el producto salió al mercado',
        tipo: 'fecha',
        aplica_a: 'productos',
        grupo: 'Información Comercial',
        industria: 'general',
        orden: 3,
        placeholder: null,
        ayuda: 'Selecciona la fecha de lanzamiento',
        icono: 'calendar',
        valor_default: null,
        opciones: null,
        validaciones: {},
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'garantia_meses',
        etiqueta: 'Garantía (meses)',
        descripcion: 'Duración de la garantía en meses',
        tipo: 'numero',
        aplica_a: 'productos',
        grupo: 'Información Comercial',
        industria: 'general',
        orden: 4,
        placeholder: 'Ej: 12',
        ayuda: 'Ingrese la duración de la garantía',
        icono: 'shield-check',
        valor_default: '12',
        opciones: null,
        validaciones: { min: 0, max: 60 },
        obligatorio: false,
        visible_en_listado: true,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'requiere_refrigeracion',
        etiqueta: 'Requiere Refrigeración',
        descripcion: 'Indica si el producto necesita cadena de frío',
        tipo: 'boolean',
        aplica_a: 'productos',
        grupo: 'Logística',
        industria: 'general',
        orden: 5,
        placeholder: null,
        ayuda: 'Marca si el producto debe refrigerarse',
        icono: 'snowflake',
        valor_default: 'false',
        opciones: null,
        validaciones: {},
        obligatorio: false,
        visible_en_listado: true,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'codigo_barras',
        etiqueta: 'Código de Barras',
        descripcion: 'Código de barras estándar (EAN13/UPC)',
        tipo: 'texto',
        aplica_a: 'productos',
        grupo: 'Identificación',
        industria: 'general',
        orden: 6,
        placeholder: 'Escanea o escribe el código',
        ayuda: 'Debe contener solo números',
        icono: 'barcode',
        valor_default: null,
        opciones: null,
        validaciones: { pattern: '^[0-9]{8,14}$' },
        obligatorio: false,
        visible_en_listado: true,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'notas_logistica',
        etiqueta: 'Notas de Logística',
        descripcion: 'Indicaciones especiales para transporte o almacenamiento',
        tipo: 'texto_largo',
        aplica_a: 'productos',
        grupo: 'Logística',
        industria: 'general',
        orden: 7,
        placeholder: 'Ej: Manipular con cuidado',
        ayuda: null,
        icono: 'truck',
        valor_default: null,
        opciones: null,
        validaciones: { maxLength: 500 },
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'fabricante',
        etiqueta: 'Fabricante',
        descripcion: 'Nombre del fabricante',
        tipo: 'texto',
        aplica_a: 'productos',
        grupo: 'Información Comercial',
        industria: 'general',
        orden: 8,
        placeholder: 'Ej: laboratorio ACME',
        ayuda: null,
        icono: 'factory',
        valor_default: null,
        opciones: null,
        validaciones: { maxLength: 120 },
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'origen',
        etiqueta: 'País de Origen',
        descripcion: 'País donde fue fabricado el producto',
        tipo: 'texto',
        aplica_a: 'productos',
        grupo: 'Información Comercial',
        industria: 'general',
        orden: 9,
        placeholder: 'Ej: Argentina',
        ayuda: null,
        icono: 'flag',
        valor_default: null,
        opciones: null,
        validaciones: { maxLength: 80 },
        obligatorio: false,
        visible_en_listado: true,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'vida_util_dias',
        etiqueta: 'Vida Útil (días)',
        descripcion: 'Cantidad estimada de días de vida útil del producto',
        tipo: 'numero',
        aplica_a: 'productos',
        grupo: 'Logística',
        industria: 'general',
        orden: 10,
        placeholder: 'Ej: 90',
        ayuda: 'Utilizado para calcular rotación y vencimientos',
        icono: 'timer',
        valor_default: null,
        opciones: null,
        validaciones: { min: 0 },
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'color_principal',
        etiqueta: 'Color Principal',
        descripcion: 'Color representativo del producto',
        tipo: 'color',
        aplica_a: 'productos',
        grupo: 'Presentación',
        industria: 'general',
        orden: 11,
        placeholder: null,
        ayuda: 'Selecciona un color para identificar el producto',
        icono: 'palette',
        valor_default: '#000000',
        opciones: null,
        validaciones: {},
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'presentacion',
        etiqueta: 'Presentación',
        descripcion: 'Formato de presentación comercial',
        tipo: 'select',
        aplica_a: 'productos',
        grupo: 'Presentación',
        industria: 'general',
        orden: 12,
        placeholder: null,
        ayuda: 'Selecciona el formato de venta',
        icono: 'package',
        valor_default: 'unidad',
        opciones: [
          { value: 'unidad', label: 'Unidad' },
          { value: 'caja', label: 'Caja' },
          { value: 'bolsa', label: 'Bolsa' },
          { value: 'pallet', label: 'Pallet' },
        ],
        validaciones: {},
        obligatorio: false,
        visible_en_listado: true,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'aplica_iva',
        etiqueta: 'Aplica IVA',
        descripcion: 'Indica si el producto está gravado con IVA',
        tipo: 'boolean',
        aplica_a: 'productos',
        grupo: 'Fiscal',
        industria: 'general',
        orden: 13,
        placeholder: null,
        ayuda: null,
        icono: 'percent',
        valor_default: 'true',
        opciones: null,
        validaciones: {},
        obligatorio: false,
        visible_en_listado: true,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'observaciones_calidad',
        etiqueta: 'Observaciones de Calidad',
        descripcion: 'Notas de control de calidad internas',
        tipo: 'texto_largo',
        aplica_a: 'productos',
        grupo: 'Calidad',
        industria: 'general',
        orden: 14,
        placeholder: 'Ej: Revisar cada lote',
        ayuda: null,
        icono: 'clipboard-list',
        valor_default: null,
        opciones: null,
        validaciones: { maxLength: 500 },
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'proveedor_principal',
        etiqueta: 'Proveedor Principal',
        descripcion: 'Proveedor habitual del artículo',
        tipo: 'texto',
        aplica_a: 'productos',
        grupo: 'Abastecimiento',
        industria: 'general',
        orden: 15,
        placeholder: 'Ej: Distribuidora Central',
        ayuda: null,
        icono: 'building',
        valor_default: null,
        opciones: null,
        validaciones: { maxLength: 150 },
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'contacto_tecnico',
        etiqueta: 'Contacto Técnico',
        descripcion: 'Persona de contacto para soporte técnico del producto',
        tipo: 'texto',
        aplica_a: 'productos',
        grupo: 'Abastecimiento',
        industria: 'general',
        orden: 16,
        placeholder: 'Nombre del referente',
        ayuda: null,
        icono: 'user',
        valor_default: null,
        opciones: null,
        validaciones: { maxLength: 120 },
        obligatorio: false,
        visible_en_listado: false,
        visible_en_detalle: true,
        activo: true,
        created_at: now,
        updated_at: now,
      },
    ];

    const serializeJson = (value) => (value === null || value === undefined ? null : JSON.stringify(value));

    const camposBaseSerialized = camposBase.map((campo) => ({
      ...campo,
      opciones: serializeJson(campo.opciones),
      validaciones: serializeJson(campo.validaciones),
    }));

    await queryInterface.bulkInsert('configuracion_campos', camposBaseSerialized, {});

    const templates = [
      {
        nombre: 'Template Farmacia',
        codigo: 'FAR-001',
        descripcion: 'Campos recomendados para productos farmacéuticos',
        industria: 'farmaceutica',
        color: '#7C3AED',
        activo: true,
        campos_config: [
          { nombre: 'principio_activo', etiqueta: 'Principio Activo', tipo: 'texto', obligatorio: true },
          { nombre: 'concentracion', etiqueta: 'Concentración', tipo: 'texto', obligatorio: true },
          { nombre: 'forma_farmaceutica', etiqueta: 'Forma Farmacéutica', tipo: 'select', obligatorio: true, opciones: [
            { value: 'comprimido', label: 'Comprimido' },
            { value: 'capsula', label: 'Cápsula' },
            { value: 'jarabe', label: 'Jarabe' },
            { value: 'inyectable', label: 'Inyectable' },
          ] },
          { nombre: 'registro_anmat', etiqueta: 'Registro ANMAT', tipo: 'texto', obligatorio: true },
          { nombre: 'temperatura_almacenamiento', etiqueta: 'Temperatura de Almacenamiento', tipo: 'numero', obligatorio: false, validaciones: { min: -10, max: 25 } },
          { nombre: 'fecha_vencimiento', etiqueta: 'Fecha de Vencimiento', tipo: 'fecha', obligatorio: true },
          { nombre: 'laboratorio', etiqueta: 'Laboratorio', tipo: 'texto', obligatorio: true },
        ],
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'Template Alimentos',
        codigo: 'ALI-001',
        descripcion: 'Campos base para productos alimenticios',
        industria: 'alimentos',
        color: '#10B981',
        activo: true,
        campos_config: [
          { nombre: 'fecha_elaboracion', etiqueta: 'Fecha de Elaboración', tipo: 'fecha', obligatorio: true },
          { nombre: 'fecha_vencimiento', etiqueta: 'Fecha de Vencimiento', tipo: 'fecha', obligatorio: true },
          { nombre: 'temperatura_conservacion', etiqueta: 'Temperatura de Conservación', tipo: 'numero', obligatorio: false, validaciones: { min: -20, max: 30 } },
          { nombre: 'alergenos', etiqueta: 'Alérgenos', tipo: 'multi_select', obligatorio: false, opciones: [
            { value: 'gluten', label: 'Gluten' },
            { value: 'lactosa', label: 'Lactosa' },
            { value: 'frutos_secos', label: 'Frutos Secos' },
            { value: 'soja', label: 'Soja' },
          ] },
          { nombre: 'organico', etiqueta: 'Orgánico', tipo: 'boolean', obligatorio: false },
          { nombre: 'valor_calorico', etiqueta: 'Valor Calórico (kcal)', tipo: 'numero', obligatorio: false, validaciones: { min: 0 } },
          { nombre: 'info_nutricional', etiqueta: 'Información Nutricional', tipo: 'texto_largo', obligatorio: false },
        ],
        created_at: now,
        updated_at: now,
      },
      {
        nombre: 'Template Textil',
        codigo: 'TEX-001',
        descripcion: 'Campos sugeridos para indumentaria y textiles',
        industria: 'textil',
        color: '#F59E0B',
        activo: true,
        campos_config: [
          { nombre: 'talla', etiqueta: 'Talla', tipo: 'select', obligatorio: true, opciones: [
            { value: 'xs', label: 'XS' },
            { value: 's', label: 'S' },
            { value: 'm', label: 'M' },
            { value: 'l', label: 'L' },
            { value: 'xl', label: 'XL' },
          ] },
          { nombre: 'genero', etiqueta: 'Género', tipo: 'select', obligatorio: false, opciones: [
            { value: 'mujer', label: 'Mujer' },
            { value: 'hombre', label: 'Hombre' },
            { value: 'unisex', label: 'Unisex' },
            { value: 'ninos', label: 'Niños' },
          ] },
          { nombre: 'material', etiqueta: 'Material', tipo: 'texto', obligatorio: true },
          { nombre: 'instrucciones_cuidado', etiqueta: 'Instrucciones de Cuidado', tipo: 'texto_largo', obligatorio: false },
          { nombre: 'color', etiqueta: 'Color', tipo: 'texto', obligatorio: true },
          { nombre: 'temporada', etiqueta: 'Temporada', tipo: 'select', obligatorio: false, opciones: [
            { value: 'primavera', label: 'Primavera' },
            { value: 'verano', label: 'Verano' },
            { value: 'otonio', label: 'Otoño' },
            { value: 'invierno', label: 'Invierno' },
          ] },
          { nombre: 'codigo_sku', etiqueta: 'Código SKU', tipo: 'texto', obligatorio: true },
        ],
        created_at: now,
        updated_at: now,
      },
    ];

    const templatesSerialized = templates.map((template) => ({
      ...template,
      campos_config: JSON.stringify(template.campos_config),
    }));

    await queryInterface.bulkInsert('templates_industria', templatesSerialized, {});
  },

  async down(queryInterface, Sequelize) {
    await queryInterface.bulkDelete('templates_industria', {
      codigo: { [Sequelize.Op.in]: ['FAR-001', 'ALI-001', 'TEX-001'] },
    }, {});

    await queryInterface.bulkDelete('configuracion_campos', {
      nombre: {
        [Sequelize.Op.in]: [
          'peso_neto',
          'unidad_medida',
          'fecha_lanzamiento',
          'garantia_meses',
          'requiere_refrigeracion',
          'codigo_barras',
          'notas_logistica',
          'fabricante',
          'origen',
          'vida_util_dias',
          'color_principal',
          'presentacion',
          'aplica_iva',
          'observaciones_calidad',
          'proveedor_principal',
          'contacto_tecnico',
        ],
      },
    }, {});
  },
};
